var ChatItem=React.createClass({displayName:"ChatItem",render:function(){var e="chatItem",t="client"===this.props.source?"clientUserName":"serverUserName",s="client"===this.props.source?"clientMessage":"serverMessage";return React.createElement("div",null,React.createElement("div",{className:e},React.createElement("div",{className:t},this.props.username),React.createElement("div",{className:s},this.props.text)))}}),ChatInitialization=React.createClass({displayName:"ChatInitialization",initializeUser:function(){var e=$(ReactDOM.findDOMNode(this)).find("input[data-username]"),t=e.val();this.props.initialize(t)},render:function(){return React.createElement("div",null,"Enter the user name:",React.createElement("input",{type:"text","data-username":!0}),"  ",React.createElement("a",{onClick:this.initializeUser,href:"#"},"Start Chatting!"))}}),UserList=React.createClass({displayName:"UserList",render:function(){for(var e=[],t=0;t<this.props.users.length;t++)e.push(React.createElement("div",{key:t,className:"userItem"},this.props.users[t]));return React.createElement("div",{style:{overflow:"hidden",display:"block",float:"left",padding:"2px"}},React.createElement("h4",null,"Participants"),e)}}),ChatWindow=React.createClass({displayName:"ChatWindow",sendMessage:function(){var e=$(ReactDOM.findDOMNode(this)).find("input[data-message]"),t=e.val();this.props.sendmessage(t),e.val("")},componentDidUpdate:function(){var e=$(ReactDOM.findDOMNode(this)).find("div[data-messages]");e.length&&(e[0].scrollTop=e[0].scrollHeight)},render:function(){var e,t=[],s=0;if(this.props.messages.length)for(;s<this.props.messages.length;s++)e=this.props.messages[s].UserId,t.push(React.createElement(ChatItem,{username:this.props.messages[s].UserName,datetime:this.props.messages[s].DateTime,source:e===this.props.userid?"client":"server",text:this.props.messages[s].Message,key:s}));return React.createElement("div",null,React.createElement("div",{style:{overflow:"hidden"}},React.createElement("div",{"data-messages":!0,className:"messagesDiv"},t),React.createElement(UserList,{users:this.props.users})),React.createElement("div",{style:{display:"block",width:"400px"}},"Message: ",React.createElement("input",{type:"text","data-message":!0}),"   ",React.createElement("a",{onClick:this.sendMessage,href:"#"},"Send")))}}),MainChat=React.createClass({displayName:"MainChat",getInitialState:function(){return{ChatHub:$.connection.MainHub,Messages:[],UserInitialized:!0,UserName:"",UserId:"00000000-0000-0000-0000-000000000000",Users:[]}},pushNewMessage:function(e,t,s,a,i){var n=this.state.Messages;n.push({Id:e,UserId:t,UserName:s,Message:a,DateTime:i}),this.setState({Messages:n})},pushUserList:function(e){this.setState({Users:e})},componentWillMount:function(){this.state.ChatHub.client.pushNewMessage=this.pushNewMessage,this.state.ChatHub.client.pushUserList=this.pushUserList,$.connection.hub.start().done(function(){console.log("SignalR Hub Started!")})},initializeUser:function(e){var t=this;$.getJSON("./Chat/GetNewUserId/?userName="+e).then(function(s){t.setState({UserInitialized:!0,UserName:e,UserId:s})})},sendMessage:function(e){var t={Id:"00000000-0000-0000-0000-000000000000",UserId:this.state.UserId,UserName:this.state.UserName,Message:e,DateTime:new Date};$.ajax({method:"post",url:"./Chat/PostChat",data:JSON.stringify(t),dataType:"json",contentType:"application/json; charset=utf-8"})},render:function(){return this.state.UserInitialized?React.createElement(ChatWindow,{messages:this.state.Messages,username:this.state.UserName,userid:this.state.UserId,sendmessage:this.sendMessage,users:this.state.Users}):React.createElement(ChatInitialization,{initialize:this.initializeUser})}});ReactDOM.render(React.createElement(MainChat,null),document.getElementById("container"));